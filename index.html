<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lampu Sidik Jari — Simulasi & WebAuthn</title>
  <style>
    :root{ --bg:#071026; --card:#0b1220; --accent:#ffd166; --muted:#9aa6b2 }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#041022 0%, #07102a 100%); color:#e6eef6; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px}
    .wrap{width:100%; max-width:980px; display:grid; grid-template-columns:1fr 420px; gap:24px; align-items:center}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:20px; border-radius:14px; box-shadow:0 8px 30px rgba(2,6,23,0.6)}

    /* Lamp */
    .lamp-area{display:flex; flex-direction:column; gap:14px; align-items:center}
    .lamp-svg{width:240px; height:240px}
    .lamp-on .bulb-fill{filter:drop-shadow(0 20px 40px rgba(255,200,80,0.25));}
    .status{font-weight:700; color:var(--muted)}

    /* Scanner */
    .scanner{display:flex; flex-direction:column; gap:12px; align-items:center}
    .pad{width:260px; height:260px; border-radius:18px; background:linear-gradient(180deg,#06101b,#081827); display:flex; align-items:center; justify-content:center; border:2px dashed rgba(255,255,255,0.03); position:relative; overflow:hidden; touch-action:manipulation}
    .finger{width:120px; height:160px; border-radius:60px 60px 40px 40px; display:flex; align-items:center; justify-content:center; cursor:pointer; user-select:none; -webkit-tap-highlight-color: transparent}
    .finger svg{opacity:0.95}

    /* visual press*/
    .imprint{position:absolute; width:40%; height:40%; border-radius:50%; background:radial-gradient(circle at 40% 30%, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); transform:scale(0); opacity:0; pointer-events:none}
    .imprint.show{transform:scale(1); opacity:1; transition:transform 200ms ease, opacity 200ms ease}

    .scan-wave{position:absolute; inset:0; pointer-events:none}
    .wave{position:absolute; left:50%; transform:translateX(-50%); width:60%; height:2px; background:linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent); opacity:0}
    .wave.anim{animation:scan 1.2s ease-in-out}
    @keyframes scan{0%{top:8% ; opacity:0} 18%{opacity:1} 50%{top:50%} 82%{opacity:1} 100%{top:92%; opacity:0}}

    .controls{display:flex; gap:10px; margin-top:6px}
    button{background:transparent; border:1px solid rgba(255,255,255,0.06); color:inherit; padding:10px 12px; border-radius:10px; cursor:pointer}
    button.primary{background:linear-gradient(90deg,#ffd166,#ff9f1c); color:#081422; border:none; font-weight:700}
    .note{font-size:13px; color:var(--muted); text-align:center}

    /* responsive */
    @media (max-width:960px){.wrap{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card lamp-area" id="lampCard">
      <svg class="lamp-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <radialGradient id="g1" cx="50%" cy="30%" r="60%">
            <stop offset="0%" stop-color="#fff7d9" stop-opacity="1"/>
            <stop offset="60%" stop-color="#ffd166" stop-opacity="0.98"/>
            <stop offset="100%" stop-color="#ff9f1c" stop-opacity="0.9"/>
          </radialGradient>
        </defs>
        <g transform="translate(100,60)">
          <ellipse cx="0" cy="70" rx="48" ry="14" fill="rgba(0,0,0,0.35)" />
          <g id="bulbGroup">
            <path class="bulb-fill" d="M-44,-22 C-44,34 -10,64 0,72 C10,64 44,34 44,-22 C44,-64 -44,-64 -44,-22 Z" fill="#222" />
            <rect x="-24" y="72" width="48" height="18" rx="4" fill="#222" />
            <rect x="-16" y="92" width="32" height="12" rx="3" fill="#111" />
          </g>
        </g>
      </svg>
      <div class="status" id="lampStatus">Status: <span id="lampState">Mati</span></div>
      <div class="note">Sentuh area sidik jari di kanan dengan jari (tap / tekan) — <strong>simulasi</strong> + opsi WebAuthn.</div>
    </section>

    <aside class="card scanner">
      <h3 style="margin:0">Area Sidik Jari</h3>
      <p style="margin:0; color:var(--muted); font-size:13px">Simulasi sentuhan + opsi WebAuthn (untuk device dengan sensor, via HTTPS).</p>

      <div class="pad" id="pad" aria-label="Area sidik jari" role="button" tabindex="0">
        <div class="scan-wave" id="scanWave"><div class="wave" id="wave1"></div></div>
        <div class="imprint" id="imprint"></div>
        <div class="finger" id="finger" title="Sentuh untuk scan" role="button" tabindex="0">
          <svg width="64" height="96" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 6v5a5 5 0 0010 0V6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 16v6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <div class="controls">
        <button id="tryWebauth">Coba WebAuthn</button>
        <button class="primary" id="resetBtn">Reset</button>
      </div>
      <p class="note" id="log">Log: siap.</p>
      <small class="note">Catatan: WebAuthn butuh server HTTPS + backend challenge untuk benar-benar berfungsi. Jika gagal, akan fallback ke simulasi.</small>
    </aside>
  </div>

  <script>
    // Elemen
    const lampCard = document.getElementById('lampCard');
    const lampStateEl = document.getElementById('lampState');
    const bulb = document.querySelector('.bulb-fill');
    const pad = document.getElementById('pad');
    const wave1 = document.getElementById('wave1');
    const imprint = document.getElementById('imprint');
    const log = document.getElementById('log');
    const tryWebauthBtn = document.getElementById('tryWebauth');
    const resetBtn = document.getElementById('resetBtn');

    let isLampOn = false;

    function setLamp(on){
      isLampOn = !!on;
      if(isLampOn){
        lampCard.classList.add('lamp-on');
        bulb.setAttribute('fill','url(#g1)');
        lampStateEl.textContent = 'Menyala';
        log.textContent = 'Log: Lampu menyala.';
      } else {
        lampCard.classList.remove('lamp-on');
        bulb.setAttribute('fill','#222');
        lampStateEl.textContent = 'Mati';
        log.textContent = 'Log: Lampu mati.';
      }
    }

    function animateScan(){
      wave1.classList.remove('anim');
      void wave1.offsetWidth;
      wave1.classList.add('anim');
    }

    function showImprint(xPct=50, yPct=55){
      imprint.style.left = xPct + '%';
      imprint.style.top = yPct + '%';
      imprint.classList.add('show');
      setTimeout(()=> imprint.classList.remove('show'), 700);
    }

    function vibrate(pattern=40){
      try{ if(navigator.vibrate) navigator.vibrate(pattern); } catch(e){}
    }

    async function simulatedFingerprintAuth(xPct=50,yPct=55){
      log.textContent = 'Log: Memulai pemindaian (simulasi)...';
      showImprint(xPct, yPct);
      animateScan();
      vibrate([30]);
      await new Promise(r => setTimeout(r, 900));
      log.textContent = 'Log: Sidik jari terverifikasi (simulasi).';
      setLamp(!isLampOn);
    }

    // Pointer events (tap/click)
    pad.addEventListener('pointerdown', e =>{
      const rect = pad.getBoundingClientRect();
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);
      const xPct = Math.round((clientX - rect.left) / rect.width * 100);
      const yPct = Math.round((clientY - rect.top) / rect.height * 100);
      simulatedFingerprintAuth(xPct, yPct);
    });

    // Reset
    resetBtn.addEventListener('click', ()=>{ setLamp(false); log.textContent='Log: Di-reset.'; vibrate([50]); });

    // WebAuthn attempt
    tryWebauthBtn.addEventListener('click', async ()=>{
      if(!window.PublicKeyCredential){
        log.textContent = 'Log: WebAuthn tidak didukung di browser ini, fallback simulasi.';
        simulatedFingerprintAuth();
        return;
      }
      try{
        log.textContent = 'Log: Mencoba WebAuthn...';
        const publicKey = {
          challenge: Uint8Array.from('demo-challenge-123456', c => c.charCodeAt(0)),
          timeout: 60000,
          userVerification: 'preferred'
        };
        const cred = await navigator.credentials.get({ publicKey });
        if(cred){
          log.textContent = 'Log: WebAuthn berhasil — lampu menyala.';
          setLamp(true);
        } else {
          log.textContent = 'Log: WebAuthn tidak berhasil, fallback simulasi.';
          simulatedFingerprintAuth();
        }
      } catch(err){
        console.warn('WebAuthn error', err);
        log.textContent = 'Log: WebAuthn gagal, fallback simulasi.';
        simulatedFingerprintAuth();
      }
    });

    // Init
    setLamp(false);
  </script>
</body>
</html>
